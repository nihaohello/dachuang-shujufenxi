杯具啊
杯具啊
可能这个页面已经飞走了
回首页
杯具啊
杯具啊
可能这个页面已经飞走了
回首页
专业面向开发者的中文技术问答社区
开发者
程序员
中文
问答
社区
每周精选
每周精选
从
到
移动跨平台方案的真相
每周精选
盗版猖獗时代
谁会成为终结者
每周精选
思否社区祝所有程序员们
劳动节快乐
每周精选
一起为开发者社区助力
阿里
腾讯
京东
美团
滴滴
个推
有赞等技术团队都已入驻思否社区
思否讲堂新版上线
让学习过程更专注
持续招募优质讲师
每周精选
之父为
再发声
每周精选
金三银四跳槽季
前端面试汇总
每周精选
进阶必备
案例详解
每周精选
零基础如何全面掌握
每周精选
如何成为一名优秀的工程师
每周精选
基础教程
每周精选
优秀资源汇总
每周精选
假期结束
开工啦
每周精选
春节愉快
阖家欢乐
每周精选
重载和重写有什么区别
每周精选
有哪些鲜为人知但很有意思的网站
每周精选
高级前端开发工程师必备的知识图谱
每周精选
一入
深似海之
语言基础与代码设计
每周精选
年终总结
每周精选
每周精选
从入门到上线一个小程序
每周精选
每天一个设计模式
每周精选
技术栈开发实战
每周精选
安全开发规范
每周精选
零基础学习
每周精选
微信小程序黑客马拉松正式启动
每周精选
免费的计算机编程中文书籍索引
每周精选
最佳实践
每周精选
个让你工作效率翻倍的插件和编辑技巧
每周精选
常见面试问题
你能答好吗
杯具啊
杯具啊
可能这个页面已经飞走了
回首页
杯具啊
杯具啊
可能这个页面已经飞走了
回首页
杯具啊
杯具啊
可能这个页面已经飞走了
回首页
杯具啊
杯具啊
可能这个页面已经飞走了
回首页
标签树
思否
思否
为开发者提供问答
学习与交流编程知识的平台
创造属于开发者的时代
思否
前端
最新问题
最新文章
你的浏览器实在
太太太太太太旧了
放学别走
升级完浏览器再说
立即升级
首页
问答
专栏
讲堂
更多
职位
活动
标签
徽章
首页
问答
专栏
讲堂
圈子
发现
活动
标签
酷工作
排行榜
徽章
笔记
开发手册
广告投放
搜索
搜索问题或关键字
立即登录
免费注册
标签
标签不仅能组织和归类你的内容
还能关联相似的内容
正确的使用标签将让你的问题被更多人发现和解决
常用标签
全部
开发语言
前端开发
正则表达式
正则表达式
开发
小程序开发
小程序
小程序
微信小程序
微信小程序
支付宝小程序
支付宝小程序
百度智能小程序
百度智能小程序
微信开发者工具
微信开发者工具
头条小程序
头条小程序
区块链
比特币
比特币
区块链
区块链
智能合约
智能合约
以太坊
以太坊
数字化货币
数字化货币
人工智能
人工智能
人工智能
自然语言处理
自然语言处理
自动驾驶
自动驾驶
神经网络
神经网络
数据挖掘
数据挖掘
机器学习
机器学习
深度学习
深度学习
开发
开发
开发
数据库
数据库
数据库
开发
开发
开发
开发工具
云计算
云计算
云计算
又拍云存储
又拍云存储
七牛云存储
七牛云存储
百度云
百度云
金山云
金山云
美团云
美团云
腾讯云
腾讯云
开发
搜索
搜索引擎
搜索引擎
中文分词
中文分词
全文检索
全文检索
开放平台
微信
微信
百度
百度
微信公众平台
微信公众平台
微信开放平台
微信开放平台
服务器
负载均衡
负载均衡
缓存
缓存
社区子站
新手上路
新手上路
面向新手开发者的问题集中营
技术问答
技术问答
社区力量为主
同时有
官方技术人员支持的旨在推广
的普及和最佳使用方案的社区
七牛云存储问答
七牛云存储问答
非结构化静态文件的高速稳定安全云存储平台
开源硬件与嵌入式问答
开源硬件与嵌入式问答
树莓派
与其他开源硬件开发问答专区
社区建设
社区建设
社区建设建议反馈讨论
问答
问答
移动应用开发提供一站式解决方案
问答
问答
非结构化数据云存储
云处理
云分发平台
微信开放平台问答
微信开放平台问答
微信开放平台
问答专区
技术问答
技术问答
技术问答
开发者问答
开发者问答
开发者问答
官方社区
官方社区
社区技术问答平台
问答社区
问答社区
声网
实时云开发问答社区
中兴
平台
中兴
平台
中兴物联网技术问答
葡萄城
葡萄城
葡萄城技术问答
技术问答
技术问答
联合
共同推出技术问答专区
在这里你将得到来自官方技术人员的帮助
并和像你一样的技术人员交流
一起把
做的更大更强
产品
热门问答
热门专栏
热门讲堂
最新活动
技术圈
酷工作
移动客户端
课程
开发课程
开发课程
开发课程
前端开发课程
移动开发课程
资源
每周精选
用户排行榜
徽章
帮助中心
声望与权限
社区服务中心
合作
关于我们
广告投放
职位发布
讲师招募
联系我们
关注
产品技术日志
社区运营日志
市场运营日志
团队日志
社区访谈
微信
新浪微博
条款
服务条款
内容许可
扫一扫下载
当前呈现版本
浙
备
号
浙公网安备
号
杭州堆栈科技有限公司版权所有
存储服务由
又拍云
赞助提供
移动版
桌面版
回顶部
手机号
或
位手机号
或
密码
忘记密码
请输入密码
手机验证码登录
登录
更多登录方式
注册新账号
登录即表示你同意网站的
服务条款
你的名字
真实姓名或常用昵称
手机号
位手机号
右侧的验证码
短信验证码
获取验证码
密码
不少于
位的密码
注册
更多登录方式
已有账号登录
登录即表示你同意网站的
服务条款
手机号
位手机号
验证码
短信验证码
获取验证码
密码登录
手机号或
登录
更多登录方式
注册新账号
登录即表示你同意网站的
服务条款
为了保证账号安全
请先绑定手机
手机号码
仅只支持大陆手机号
验证码
短信验证码
获取验证码
浅析
内存使用
有赞技术
思否
在使用
进行计算时
我们经常会碰到作业
的情况
而且很大一部分情况是发生在
阶段
那么在
中具体是哪些地方会使用比较多的内存而有可能导致
呢
为
大数据
程序员
最新问题
最新文章
大数据
程序员
推荐引擎
你的浏览器实在
太太太太太太旧了
放学别走
升级完浏览器再说
立即升级
首页
问答
专栏
讲堂
更多
职位
活动
标签
徽章
首页
问答
专栏
讲堂
圈子
发现
活动
标签
酷工作
排行榜
徽章
笔记
开发手册
广告投放
搜索
搜索问题或关键字
立即登录
免费注册
专栏
有赞技术
文章详情
有赞技术
有赞技术
有赞技术
发布于
有赞技术
关注专栏
发布
浅析
内存使用
原创
大数据
大数据
程序员
程序员
次阅读
读完需要
分钟
在使用
进行计算时
我们经常会碰到作业
的情况
而且很大一部分情况是发生在
阶段
那么在
中具体是哪些地方会使用比较多的内存而有可能导致
呢
为此
本文将围绕以上问题梳理
内存管理和
过程中与内存使用相关的知识
然后
简要分析下在
中有可能导致
的原因
一
内存管理和消费模型
在分析
内存使用之前
我们首先了解下以下问题
当一个
子任务
被分配到
上运行时
管理内存以及消费内存的大体模型是什么样呢
注
由于
主要发生在
端
所以接下来的讨论主要针对
端的内存管理和使用
在
中
使用抽象类
来表示需要使用内存的消费者
在这个类中定义了分配
释放以及
内存数据到磁盘的一些方法或者接口
具体的消费者可以继承
从而实现具体的行为
因此
在
执行过程中
会有各种类型不同
数量不一的具体消费者
如在
中使用的
等等
具体后面会分析
会将申请
释放相关内存的工作交由
来执行
当一个
被分配到
上运行时
会创建一个
在
执行分配内存之前
需要首先向
进行申请
然后由
借助
执行实际的内存分配
中的
会统一管理内存的使用
由于每个
在执行实际的内存分配之前
会首先向
提出申请
因此
会对当前进程使用内存的情况有着全局的了解
和
之前的对应关系
如下图
总体上
一个
对应着至少一个
具体由
参数指定
而一个
对应着多个
具体由任务而定
了解了以上内存消费的整体过程以后
有两个问题需要注意下
当有多个
同时在
上执行时
将会有多个
共享
管理的内存
那么
是怎么分配的呢
答案是每个任务可以分配到的内存范围是
其中
是正在运行的
个数
因此
多个并发运行的
会使得每个
可以获得的内存变小
前面提到
在
中有
方法
当
申请不到足够的内存时
可以
当前内存到磁盘
从而避免无节制的使用内存
但是
对于堆内内存的申请和释放实际是由
来管理的
因此
在统计堆内内存具体使用量时
考虑性能等各方面原因
目前采用的是抽样统计的方式来计算
已经使用的内存
从而造成堆内内存的实际使用量不是特别准确
从而有可能因为不能及时
而导致
二
过程
整体上
具体过程如下图
主要分为两个阶段
和
阶段大体经历排序
最低要求是需要按照分区进行排序
可能的聚合
和归并
有多个文件
磁盘的情况
最终每个写
会产生数据和索引两个文件
其中
数据文件会按照分区进行存储
即相同分区的数据在文件中是连续的
而索引文件记录了每个分区在文件中的起始和结束位置
而对于
首先可能需要通过网络从各个
任务节点获取给定分区的数据
即数据文件中某一段连续的区域
然后经过排序
归并等过程
最终形成计算结果
对于
当前有三种实现
具体分别为
和
具体使用哪一个实现有一个判断条件
此处不表
而
只有一种实现
阶段分析
分析
对于
的实现
大体实现过程是首先为每个分区创建一个临时分区文件
数据写入对应的分区文件
最终所有的分区文件合并成一个数据文件
并且产生一个索引文件
由于这个过程不做排序
如果需要
不会使用这个实现
等操作
因此对于
总体来说是不怎么耗费内存的
分析
是最一般的实现
也是日常使用最频繁的
主要委托
做数据插入
排序
归并
聚合
以及最终写数据和索引文件的工作
实现了之前提到的
接口
下面分析一下各个过程使用内存的情况
对于数据写入
根据是否需要做
数据会被插入到
这个
或者
这个数组中
每隔一段时间
当向
申请不到足够的内存时
或者数据量超过
这个阈值时
默认是
的最大值
不起作用
就会进行
内存数据到文件
假设可以源源不断的申请到内存
那么
阶段的所有数据将一直保存在内存中
由此可见
或者
是比较吃内存的
无论是
还是
使用的排序算法是
在使用该算法是正常情况下使用的临时额外空间是很小
但是最坏情况下是
其中
表示待排序的数组长度
具体见
实现
当插入数据因为申请不到足够的内存将会
数据到磁盘
在将最终排序结果写入到数据文件之前
需要将内存中的
或者
和已经
到磁盘的
进行合并
的大体过程如下图
从上图可见
大体差不多就是归并排序的过程
由此可见这个过程是没有太多额外的内存消耗
归并过程中的聚合计算大体也是差不多的过程
唯一需要注意的是键值碰撞的情况
即当前输入的各个有序队列的键值的哈希值相同
但是实际的键值不等的情况
这种情况下
需要额外的空间保存所有键值不同
但哈希值相同值的中间结果
但是总体上来说
发生这种情况的概率并不是特别大
写数据文件的过程涉及到不同数据流之间的转化
而在流的写入过程中
一般都有缓存
主要由参数
和
控制
总体上这部分开销也不大
以上分析了
阶段的主要过程
从中可以看出主要的内存消耗在写入
或者
这个阶段
是对
的优化
大体上也和
差不多
在此不再赘述
从内存使用角度看
主要差异在以下两点
一方面
在
的
或者
中
存储的是键值或者值的具体类型
也就是
对象
是反序列化过后的数据
而在
的
中数据是序列化以后存储到实际的
中
而且在写入数据过程中会额外写入长度信息
总体而言
序列化以后数据大小是远远小于序列化之前的数据
另一方面
中需要额外的存储记录
它保存着分区信息和实际指向序列化后数据的指针
经过编码的
以及
相对于
中这部分存储的开销是额外的
阶段分析
主要经历从获取数据
序列化流
添加指标统计
可能的聚合
计算以及排序等过程
大体流程如下图
以上计算主要都是迭代进行
在以上步骤中
比较复杂的操作是从远程获取数据
聚合和排序操作
接下来
依次分析这三个步骤内存的使用情况
数据获取分为远程获取和本地获取
本地获取将直接从本地的
取数据
而对于远程数据
需要走网络
在远程获取过程中
有相关参数可以控制从远程并发获取数据的大小
正在获取数据的请求数
以及单次数据块请求是否放到内存等参数
具体参数包括
默认
和
考虑到数据倾斜的场景
如果
阶段有一个
数据特别的大
默认情况由于
没有做限制
所以在这个阶段需要将需要获取的整个
数据放到
端的内存中
这个时候是非常的耗内存的
可以设置
值
如果超过该阈值
可以落盘
避免这种情况的
另外
在获取到数据以后
默认情况下会对获取的数据进行校验
参数
控制
这个过程也增加了一定的内存消耗
对于需要聚合和排序的情况
这个过程是借助
来实现的
整个插入
以及
的过程和
阶段差不多
总体上
这块也是比较消耗内存的
但是因为有
操作
当内存不足时
可以将内存数据刷到磁盘
从而释放内存空间
三
可能性分析
围绕内存使用
前面比较详细的分析了
内存管理以及在
过程可能使用较多内存的地方
接下来总结的要点如下
首先需要注意
端的任务并发度
多个同时运行的
会共享
端的内存
使得单个
可使用的内存减少
无论是在
还是在
端
插入数据到内存
排序
归并都是比较都是比较占用内存的
因为有
理论上不会因为数据倾斜造成
但是
由于对堆内对象的分配和释放是由
管理的
而
是通过采样获取已经使用的内存情况
有可能因为采样不准确而不能及时
导致
在
获取数据时
由于数据倾斜
有可能造成单个
的数据非常的大
默认情况下是需要有足够的内存来保存单个
的数据
因此
此时极有可能因为数据倾斜造成
可以设置
参数
设置这个参数以后
超过一定的阈值
会自动将数据
到磁盘
此时便可以避免因为数据倾斜造成
的情况
在我们的生产环境中也验证了这点
在设置这个参数到合理的阈值后
生产环境任务
的情况大大减少了
在
获取数据后
默认情况会对数据流进行解压校验
参数
正如在代码注释中提到
由于这部分没有
到磁盘操作
也有很大的可性能会导致
在我们的生产环境中也有碰到因为检验导致
的情况
四
小结
本文主要围绕内存使用这个点
对
的过程做了一个比较详细的梳理
并且分析了可能造成
的一些情况以及我们在生产环境碰到的一些问题
本文主要基于作者对
源码的理解以及实际生产过程中遇到
案例总结而成
限于经验等各方面原因
难免有所疏漏或者有失偏颇
如有问题
欢迎联系一起讨论
文章
举报
浅析
内存使用
赞
收藏
你可能感兴趣的
评论
默认排序
时间排序
载入中
显示更多评论
文明社会
理性评论
发布评论
想在上方展示你的广告
推广链接
目录
分享
分享到微博
取消
分享
后台返回信息
我要
该
理由是
返回重选
取消
提交
后台返回信息
标题
请输入
标题
描述
请输入
描述
请输入
取消
提交
在
学习技能
解决问题
每个月
我们帮助
万的开发者解决各种各样的技术问题
并助力他们在技术能力
职业生涯
影响力上获得提升
免费注册
立即登录
产品
热门问答
热门专栏
热门讲堂
最新活动
技术圈
酷工作
移动客户端
课程
开发课程
开发课程
开发课程
前端开发课程
移动开发课程
资源
每周精选
用户排行榜
徽章
帮助中心
声望与权限
社区服务中心
合作
关于我们
广告投放
职位发布
讲师招募
联系我们
关注
产品技术日志
社区运营日志
市场运营日志
团队日志
社区访谈
微信
新浪微博
条款
服务条款
内容许可
扫一扫下载
当前呈现版本
浙
备
号
浙公网安备
号
杭州堆栈科技有限公司版权所有
存储服务由
又拍云
赞助提供
移动版
桌面版
回顶部
手机号
或
位手机号
或
密码
忘记密码
请输入密码
手机验证码登录
登录
更多登录方式
注册新账号
登录即表示你同意网站的
服务条款
你的名字
真实姓名或常用昵称
手机号
位手机号
右侧的验证码
短信验证码
获取验证码
密码
不少于
位的密码
注册
更多登录方式
已有账号登录
登录即表示你同意网站的
服务条款
手机号
位手机号
验证码
短信验证码
获取验证码
密码登录
手机号或
登录
更多登录方式
注册新账号
登录即表示你同意网站的
服务条款
为了保证账号安全
请先绑定手机
手机号码
仅只支持大陆手机号
验证码
短信验证码
获取验证码
思否
技术圈
思否
思否
为开发者提供问答
学习与交流编程知识的平台
创造属于开发者的时代
思否
前端
最新问题
最新文章
你的浏览器实在
太太太太太太旧了
放学别走
升级完浏览器再说
立即升级
首页
问答
专栏
讲堂
更多
职位
活动
标签
徽章
首页
问答
专栏
讲堂
圈子
发现
活动
标签
酷工作
排行榜
徽章
笔记
开发手册
广告投放
搜索
搜索问题或关键字
立即登录
免费注册
圈子
这里是程序员的聚集地
根据你的兴趣认识更多的朋友
全部
我关注的
技术
创意
好玩
酷工作
其他
职业生涯
快速发财
程序员发财之道
酷工作
最近的帖子
发新帖
标题
选择发布到圈子
技术
技术圈
函数库
开发者社区
区块链爱好者
编程思想
新零售
爬虫
爬呀爬
系统架构及优化
星城前端
全栈修炼
数据结构与算法
开发
技术社区
及
有问必答
产品技术讨论
日常
前端打怪闯关
时光乄漫步
铁锹厂家
的快乐家园
学无止境
交流圈
技术研究
口碑测评
交流
前端攻城狮
老铁煮酒
编程
编程
付费圈
创意
我的作品
好玩
程序员
日常
数码极客
阿里云
命令行界面操作系统
酷工作
职业生涯
程序员发财之道
酷工作
其他
小管家
内容描述
取消
发布
招聘者必看
招聘板块职位发布规则以及发布规范
高阳
月
日
最后回复
全景求是
小姐姐
酷工作
广州不是一线城市吗
为什么
工资这么低
良工心苦
天前
最后回复
职业生涯
深圳
腾讯
招助理
前端开发工程师
名
外包
天前
最后回复
高阳
酷工作
北京
北京望石智慧科技有限公司招聘
算法工程师
后端
开发工程师
前端开发工程师各
名
木槿
天前
酷工作
厦门有想创业的技术小伙伴么
三角龙
天前
最后回复
爱不留
酷工作
裸辞
个月
找不到新工作
我这样的程序员多吗
李晨
天前
最后回复
命中水
快速发财
程序员发财之道
北京
内推
招聘
前端
后端
算法
容器
大数据工程师
产品
天前
最后回复
努力学会微笑
酷工作
上海
趣头条
招聘
中间件研发
推荐算法
广告算法
工程师若干名
天前
酷工作
上海
英语流利说
招聘前端
后端
移动端
运维
算法
工程师
数据分析师
天前
最后回复
酷工作
大佬们平时都逛什么网站
看哪些书啊
月
日
最后回复
职业生涯
北京社招
美团网用户平台大数据与算法部
高级
资深前端工程师
月
日
酷工作
日本
东京
招一位
万人民币
我有一只小胖子
月
日
酷工作
北京
美餐网急招资深
后端工程师
有
架构
重构实操经验的小伙伴欢迎自荐
月
日
酷工作
爱奇艺北京招聘
前端开发
开发
产品经理
爱奇艺招聘
月
日
酷工作
广州
北京
直播招聘前端
工程师
薪资水平业内
爱吃葱花
月
日
酷工作
寻找
自由开发者
坐标北京
我只是一个菜鸟
月
日
最后回复
陈国志
酷工作
北京
薪人薪事
招聘
前端开发工程师
月
日
最后回复
肖雅
酷工作
北京
轮盈利
出海创业准独角兽公司招聘
多个技术职位
互联网小卖部
月
日
最后回复
肖雅
酷工作
苏州
工业园区
高级前端开发
高级前端开发管理
带团队
月
日
最后回复
肖雅
酷工作
上海
觅丁科技
招聘
前端开发小伙伴
名
月
日
最后回复
肖雅
酷工作
请大家给一些中肯的意见
谢谢
月
日
最后回复
肖雅
职业生涯
杭州
魔方乐游招聘各类技术岗
本科
年左右
唐美
月
日
最后回复
肖雅
酷工作
北京
急求各类岗位工程师
坤
在路上
月
日
最后回复
肖雅
酷工作
深圳
初创公司
升幂科技
急聘
后端一名
月
日
最后回复
肖雅
酷工作
杭州
全职
实习
轮前
招大数据平台工程师
月
日
最后回复
肖雅
酷工作
英国公司
兼职
自由职业
线上
招募前端工程师
月
日
最后回复
肖雅
酷工作
加入自己感兴趣的圈子吧
发现圈子
想在上方展示你的广告
今日热议
裸辞
个月
找不到新工作
我这样的程序员多吗
裸辞
个月
找不到新工作
我这样的程序员多吗
讨论
产品
热门问答
热门专栏
热门讲堂
最新活动
技术圈
酷工作
移动客户端
课程
开发课程
开发课程
开发课程
前端开发课程
移动开发课程
资源
每周精选
用户排行榜
徽章
帮助中心
声望与权限
社区服务中心
合作
关于我们
广告投放
职位发布
讲师招募
联系我们
关注
产品技术日志
社区运营日志
市场运营日志
团队日志
社区访谈
微信
新浪微博
条款
服务条款
内容许可
扫一扫下载
当前呈现版本
浙
备
号
浙公网安备
号
杭州堆栈科技有限公司版权所有
存储服务由
又拍云
赞助提供
移动版
桌面版
回顶部
手机号
或
位手机号
或
密码
忘记密码
请输入密码
手机验证码登录
登录
更多登录方式
注册新账号
登录即表示你同意网站的
服务条款
你的名字
真实姓名或常用昵称
手机号
位手机号
右侧的验证码
短信验证码
获取验证码
密码
不少于
位的密码
注册
更多登录方式
已有账号登录
登录即表示你同意网站的
服务条款
手机号
位手机号
验证码
短信验证码
获取验证码
密码登录
手机号或
登录
更多登录方式
注册新账号
登录即表示你同意网站的
服务条款
为了保证账号安全
请先绑定手机
手机号码
仅只支持大陆手机号
验证码
短信验证码
获取验证码
